async function applyThemePreference(){try{const e=await chrome.storage.local.get("settings"),t=e.settings?.themePreference||"system",s=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",n="system"===t?s:t;document.documentElement.dataset.theme=n,document.documentElement.style.colorScheme=n}catch{}}const elements={loadingView:document.getElementById("loading-view"),successView:document.getElementById("success-view"),errorView:document.getElementById("error-view"),errorMessage:document.getElementById("error-message"),retryBtn:document.getElementById("retry-btn")};async function handleAuth(){try{const e=new URLSearchParams(window.location.search);if(!e.get("code")&&!e.get("token"))return void showError("No authentication code received. Please try signing in again.");const t=await chrome.runtime.sendMessage({type:"AUTH_CALLBACK",params:window.location.search});t&&t.success?(showSuccess(),setTimeout(()=>{window.close()},2e3)):showError(t?.error||"Authentication failed. Please try again.")}catch(e){showError(e.message||"Failed to connect. Please try again.")}}function showSuccess(){elements.loadingView.classList.add("hidden"),elements.successView.classList.remove("hidden"),elements.errorView.classList.add("hidden")}function showError(e){elements.loadingView.classList.add("hidden"),elements.successView.classList.add("hidden"),elements.errorView.classList.remove("hidden"),elements.errorMessage.textContent=e}elements.retryBtn.addEventListener("click",()=>{window.location.href="https://aiche.app/connect-chrome"}),applyThemePreference(),handleAuth();