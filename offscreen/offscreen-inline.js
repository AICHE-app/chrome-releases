let mediaRecorder=null,stream=null;chrome.runtime.onMessage.addListener(async e=>{if("START_RECORDING"===e.type)try{stream=await navigator.mediaDevices.getUserMedia({audio:!0}),mediaRecorder=new MediaRecorder(stream),mediaRecorder.ondataavailable=async e=>{if(e.data.size>0){const a=await e.data.arrayBuffer();chrome.runtime.sendMessage({type:"AUDIO_CHUNK",chunk:a})}},mediaRecorder.start(1e3)}catch(e){chrome.runtime.sendMessage({type:"RECORDING_ERROR",error:e.message})}else"STOP_RECORDING"===e.type&&(mediaRecorder&&mediaRecorder.stop(),stream&&stream.getTracks().forEach(e=>e.stop()))});