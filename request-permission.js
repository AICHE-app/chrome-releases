async function applyThemePreference(){try{const e=await chrome.storage.local.get("settings"),t=e.settings?.themePreference||"system",s=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",a="system"===t?s:t;document.documentElement.dataset.theme=a,document.documentElement.style.colorScheme=a}catch{}}const grantBtn=document.getElementById("grant-btn"),status=document.getElementById("status");grantBtn.addEventListener("click",async()=>{try{grantBtn.disabled=!0,status.textContent="Requesting permission...",status.className="",(await navigator.mediaDevices.getUserMedia({audio:!0})).getTracks().forEach(e=>e.stop()),status.textContent="Permission granted! You can close this tab.",status.className="success",setTimeout(()=>{window.close()},2e3)}catch(e){status.textContent="Permission denied. Please try again.",status.className="error",grantBtn.disabled=!1}}),applyThemePreference();