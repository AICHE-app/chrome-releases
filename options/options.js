(()=>{"use strict";const e={encryptedAccessToken:void 0,encryptedRefreshToken:void 0,tokenStorageVersion:void 0,machineId:void 0,deviceId:void 0,accessToken:void 0,refreshToken:void 0,tokenExpiresAt:0,userEmail:"",userId:null,isSubscribed:!1,subscriptionPlan:null,autoPaste:!0,showNotifications:!0,showFloatingWidget:!0,typingSpeed:"instant",historyRetentionDays:30,themePreference:"system",hasShownWelcome:!1,hasGivenPrivacyConsent:!1,pendingTranscriptions:[],history:[]};let t=null;async function n(){if(t)return{...t};const n=await chrome.storage.local.get("settings"),s={...e,...n.settings||{}};return t=s,s}async function s(e){const s=await n();t={...s,...e},await chrome.storage.local.set({settings:t}),t=null}let i="system",a=null,o=!1;function c(e){return"light"===e||"dark"===e||"system"===e?e:"system"}function r(e){!function(e){const t=document.documentElement;t.dataset.theme=e,t.style.colorScheme=e}(function(e){return"light"===e||"dark"===e?e:window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}(e))}const d={autoPaste:document.getElementById("auto-paste"),showNotifications:document.getElementById("show-notifications"),showFloatingWidget:document.getElementById("show-floating-widget"),typingSpeed:document.getElementById("typing-speed"),historyRetention:document.getElementById("history-retention"),themePreference:document.getElementById("theme-preference"),shortcutsLink:document.getElementById("shortcuts-link"),saveStatus:document.getElementById("save-status")};function h(){d.saveStatus.classList.remove("hidden"),setTimeout(()=>{d.saveStatus.classList.add("hidden")},2e3)}!async function(){await async function(){const e=await n();if(i=c(e.themePreference),r(i),!a&&window.matchMedia){a=window.matchMedia("(prefers-color-scheme: dark)");const e=()=>{"system"===i&&r("system")};a.addEventListener?a.addEventListener("change",e):a.addListener(e)}o||(chrome.storage.onChanged.addListener((e,t)=>{if("local"!==t||!e.settings?.newValue)return;if(!("themePreference"in e.settings.newValue))return;const n=c(e.settings.newValue.themePreference);n!==i&&(i=n,r(i))}),o=!0)}(),await async function(){const e=await n();d.autoPaste.checked=e.autoPaste,d.showNotifications.checked=e.showNotifications,d.showFloatingWidget.checked=e.showFloatingWidget,d.typingSpeed.value=e.typingSpeed,d.historyRetention.value=e.historyRetentionDays.toString(),d.themePreference.value=e.themePreference||"system"}(),d.autoPaste.addEventListener("change",async()=>{await s({autoPaste:d.autoPaste.checked}),h()}),d.showNotifications.addEventListener("change",async()=>{await s({showNotifications:d.showNotifications.checked}),h()}),d.showFloatingWidget.addEventListener("change",async()=>{await s({showFloatingWidget:d.showFloatingWidget.checked}),h()}),d.typingSpeed.addEventListener("change",async()=>{await s({typingSpeed:d.typingSpeed.value}),h()}),d.historyRetention.addEventListener("change",async()=>{await s({historyRetentionDays:parseInt(d.historyRetention.value)}),h()}),d.themePreference.addEventListener("change",async()=>{const e=d.themePreference.value;await s({themePreference:e}),r(e),h()}),d.shortcutsLink.addEventListener("click",e=>{e.preventDefault(),chrome.tabs.create({url:"chrome://extensions/shortcuts"})})}()})();